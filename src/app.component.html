<!-- Container principal da galeria com listeners para interação -->
<div
  class="relative h-full w-full overflow-hidden select-none grayscale transition-colors duration-500"
  [class.cursor-none]="isIdle() || isAutoNavigationActive()"
  [class.bg-black]="themeService.isDark()"
  [class.bg-slate-100]="themeService.isLight()"
  [class.p-8]="!isMobileLayout()"
  (contextmenu)="onRightClick($event)">

  @if (isMobileLayout()) {
    @switch (mobileView()) {
      @case ('capture') {
        <div class="flex min-h-screen flex-col bg-black text-white">
          <div class="flex-1 px-6 pt-8 pb-10">
            <div class="flex h-full flex-col gap-6">
              <app-webcam-capture
                [variant]="'mobile'"
                [captureAllowed]="!!mobileCaptureGallery()"
                (prepareCapture)="prepareMobileCapture()"
                (capture)="onCaptureComplete($event)">
              </app-webcam-capture>

              @if (mobileCaptureGallery()) {
                <button
                  type="button"
                  class="group flex w-full items-center gap-4 rounded-3xl border border-white/10 bg-white/5 p-4 text-left transition hover:bg-white/10 focus:outline-none focus:ring-2 focus:ring-white/30"
                  (click)="openMobileGalleryPicker()"
                  data-cursor-pointer>
                  <div class="h-16 w-16 flex-shrink-0 overflow-hidden rounded-2xl border border-white/10 bg-black/40">
                    <img
                      [src]="getGalleryCover(mobileCaptureGallery()!)"
                      class="h-full w-full object-cover"
                      loading="lazy"
                      alt="Prévia da galeria {{ mobileCaptureGallery()!.name }}">
                  </div>
                  <div class="min-w-0 flex-1">
                    <div class="flex items-center gap-2">
                      <h3 class="truncate text-base font-semibold text-white">{{ mobileCaptureGallery()!.name }}</h3>
                      <span class="rounded-full border border-emerald-400/40 px-2 py-0.5 text-[10px] uppercase tracking-[0.3em] text-emerald-200">ativo</span>
                    </div>
                    <p class="mt-1 truncate text-xs text-gray-400">
                      {{ mobileCaptureGallery()!.description || 'Sem descrição' }}
                    </p>
                    <div class="mt-2 flex flex-wrap items-center gap-3 text-[11px] uppercase tracking-[0.24em] text-gray-500">
                      @if (mobileCaptureGallery()!.createdAt) {
                        <span>{{ mobileCaptureGallery()!.createdAt }}</span>
                      }
                      <span>{{ mobileCaptureGallery()!.imageUrls.length }} fotos</span>
                    </div>
                  </div>
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    viewBox="0 0 24 24"
                    fill="none"
                    class="h-5 w-5 text-gray-400 transition group-hover:text-white">
                    <path
                      stroke="currentColor"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="1.5"
                      d="M9 5l7 7-7 7" />
                  </svg>
                </button>
              } @else {
                <button
                  type="button"
                  class="flex w-full items-center gap-4 rounded-3xl border border-dashed border-white/20 bg-white/5 p-4 text-left transition hover:bg-white/10 focus:outline-none focus:ring-2 focus:ring-white/30"
                  (click)="openMobileGalleryPicker()"
                  data-cursor-pointer>
                  <div class="h-16 w-16 flex-shrink-0 overflow-hidden rounded-2xl border border-white/10 bg-black/40">
                    <div class="flex h-full w-full items-center justify-center text-gray-500">
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke-width="1.5"
                        stroke="currentColor"
                        class="h-6 w-6">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
                      </svg>
                    </div>
                  </div>
                  <div class="min-w-0 flex-1">
                    <div class="flex items-center gap-2">
                      <h3 class="truncate text-base font-semibold text-white">Selecionar galeria</h3>
                    </div>
                    <p class="mt-1 truncate text-xs text-gray-400">
                      Escolha uma galeria para salvar suas capturas.
                    </p>
                    <div class="mt-2 flex flex-wrap items-center gap-3 text-[11px] uppercase tracking-[0.24em] text-gray-500">
                      <span>Sem data</span>
                      <span>0 fotos</span>
                    </div>
                  </div>
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    viewBox="0 0 24 24"
                    fill="none"
                    class="h-5 w-5 text-gray-400">
                    <path
                      stroke="currentColor"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="1.5"
                      d="M9 5l7 7-7 7" />
                  </svg>
                </button>
              }
            </div>
          </div>
        </div>
      }
      @case ('galleries') {
        <div class="flex min-h-screen flex-col bg-black text-white">
          <header class="flex items-center justify-between gap-4 px-6 pt-8 pb-4 text-xs uppercase tracking-[0.32em] text-gray-500">
            <button
              type="button"
              class="rounded-full border border-white/20 px-4 py-2 text-white transition hover:bg-white/10 focus:outline-none focus:ring-2 focus:ring-white/40"
              (click)="showMobileCapture()">
              ← Captura
            </button>
            <button
              type="button"
              class="rounded-full border border-white/20 px-4 py-2 text-white transition hover:bg-white/10 focus:outline-none focus:ring-2 focus:ring-white/40"
              (click)="openGalleryCreationDialogForMobileCapture()">
              Nova
            </button>
          </header>
          <div #mobileScrollContainer class="flex-1 overflow-y-auto px-6 pb-16">
            @if (galleries().length === 0) {
              <div class="mt-24 flex flex-col items-center justify-center gap-3 text-center text-gray-300">
                <svg class="h-12 w-12 text-gray-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="0.5" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" d="m2.25 15.75 5.159-5.159a2.25 2.25 0 0 1 3.182 0l5.159 5.159m-1.5-1.5 1.409-1.409a2.25 2.25 0 0 1 3.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 0 0 1.5-1.5V6a1.5 1.5 0 0 0-1.5-1.5H3.75A1.5 1.5 0 0 0 2.25 6v12a1.5 1.5 0 0 0 1.5 1.5Zm10.5-11.25h.008v.008h-.008V8.25Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Z" />
                </svg>
                <h3 class="text-lg font-medium">Nenhuma galeria ainda</h3>
                <p class="text-sm text-gray-400">Crie uma galeria para começar a capturar suas memórias.</p>
              </div>
            } @else {
              <div class="space-y-4">
                @for (gallery of galleries(); track gallery.id) {
                  <div
                    class="flex items-center gap-4 rounded-3xl border border-white/10 bg-white/5 p-4 transition hover:bg-white/10 focus-within:ring-2 focus-within:ring-white/30"
                    (click)="selectMobileCaptureGallery(gallery.id)"
                    data-cursor-pointer>
                    <div class="h-16 w-16 flex-shrink-0 overflow-hidden rounded-2xl border border-white/10 bg-black/40">
                      <img
                        [src]="getGalleryCover(gallery)"
                        class="h-full w-full object-cover"
                        loading="lazy"
                        alt="Prévia da galeria {{ gallery.name }}">
                    </div>
                    <div class="min-w-0 flex-1">
                      <div class="flex items-center gap-2">
                        <h3 class="truncate text-base font-semibold text-white">{{ gallery.name }}</h3>
                        @if (mobileCaptureGalleryId() === gallery.id) {
                          <span class="rounded-full border border-emerald-400/40 px-2 py-0.5 text-[10px] uppercase tracking-[0.3em] text-emerald-200">ativo</span>
                        }
                      </div>
                      <p class="mt-1 truncate text-xs text-gray-400">
                        {{ gallery.description || 'Sem descrição' }}
                      </p>
                      <div class="mt-2 flex flex-wrap items-center gap-3 text-[11px] uppercase tracking-[0.24em] text-gray-500">
                        @if (gallery.createdAt) {
                          <span>{{ gallery.createdAt }}</span>
                        }
                        <span>{{ gallery.imageUrls.length }} fotos</span>
                      </div>
                    </div>
                    <button
                      type="button"
                      class="rounded-full border border-white/20 p-3 text-white transition hover:bg-white/10 focus:outline-none focus:ring-2 focus:ring-white/40"
                      aria-label="Abrir galeria"
                      (click)="$event.stopPropagation(); openMobileGalleryDetail(gallery.id)">
                      <svg
                        aria-hidden="true"
                        xmlns="http://www.w3.org/2000/svg"
                        viewBox="0 0 24 24"
                        fill="none"
                        class="h-5 w-5"
                      >
                        <path
                          stroke="currentColor"
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          stroke-width="1.5"
                          d="M2.25 12s2.608-6.75 9.75-6.75 9.75 6.75 9.75 6.75-2.608 6.75-9.75 6.75S2.25 12 2.25 12Z"
                        />
                        <path
                          stroke="currentColor"
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          stroke-width="1.5"
                          d="M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"
                        />
                      </svg>
                    </button>
                  </div>
                }
              </div>
            }
          </div>
        </div>
      }
      @case ('galleryDetail') {
        <div class="flex min-h-screen flex-col bg-black text-white">
          <header class="flex items-center justify-between px-6 pt-8 pb-4 text-xs uppercase tracking-[0.3em] text-gray-500">
            <button
              type="button"
              class="rounded-full border border-white/20 px-4 py-2 text-white transition hover:bg-white/10 focus:outline-none focus:ring-2 focus:ring-white/40"
              (click)="returnToMobileGalleries()">
              ← Galerias
            </button>
            <button
              type="button"
              class="rounded-full border border-white/20 px-4 py-2 text-white transition hover:bg-white/10 focus:outline-none focus:ring-2 focus:ring-white/40"
              (click)="activeGallery() && useGalleryForCapture(activeGallery()!.id)">
              Usar esta galeria
            </button>
          </header>
          <div class="px-6 pb-16">
            <div class="space-y-2">
              <h2 class="text-2xl font-semibold text-white">{{ activeGallery()?.name ?? 'Galeria' }}</h2>
              @if (activeGallery()?.description) {
                <p class="text-xs text-gray-400">{{ activeGallery()?.description }}</p>
              }
              <div class="flex flex-wrap items-center gap-3 text-xs uppercase tracking-[0.24em] text-gray-500">
                @if (activeGallery()?.createdAt) {
                  <span>{{ activeGallery()?.createdAt }}</span>
                }
                <span>{{ images().length }} fotos</span>
              </div>
            </div>
            @if (images().length === 0) {
              <div class="mt-12 flex flex-col items-center justify-center gap-3 text-center text-gray-300">
                <svg class="h-10 w-10 text-gray-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="0.5" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" d="m2.25 15.75 5.159-5.159a2.25 2.25 0 0 1 3.182 0l5.159 5.159m-1.5-1.5 1.409-1.409a2.25 2.25 0 0 1 3.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 0 0 1.5-1.5V6a1.5 1.5 0 0 0-1.5-1.5H3.75A1.5 1.5 0 0 0 2.25 6v12a1.5 1.5 0 0 0 1.5 1.5Zm10.5-11.25h.008v.008h-.008V8.25Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Z" />
                </svg>
                <h3 class="text-lg font-medium">Esta galeria está vazia</h3>
                <p class="text-sm text-gray-400">Capture novas imagens para começar seu diário.</p>
              </div>
            } @else {
              <div class="mt-8 grid grid-cols-3 gap-3">
                @for (image of images(); track trackMobileImage($index, image); let index = $index) {
                  <button
                    type="button"
                    class="group relative aspect-square overflow-hidden rounded-3xl bg-zinc-900/60"
                    (click)="onMobilePhotoClick($event, image, index)">
                    <img
                      [src]="image"
                      loading="lazy"
                      class="h-full w-full object-cover transition-transform duration-500 group-active:scale-95 group-hover:scale-[1.03]"
                      alt="Imagem da galeria">
                    <span class="pointer-events-none absolute inset-0 border border-white/10 mix-blend-screen"></span>
                  </button>
                }
              </div>
            }
          </div>
        </div>
      }
    }
  } @else {
    @if (currentView() === 'galleries') {
      @if (galleryService.galleries().length === 0) {
        <!-- Empty state for galleries -->
        <div class="fixed inset-0 z-10 flex flex-col items-center justify-center p-4 text-center pointer-events-none">
          <svg class="h-10 w-10 text-gray-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="0.5" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" d="m2.25 15.75 5.159-5.159a2.25 2.25 0 0 1 3.182 0l5.159 5.159m-1.5-1.5 1.409-1.409a2.25 2.25 0 0 1 3.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 0 0 1.5-1.5V6a1.5 1.5 0 0 0-1.5-1.5H3.75A1.5 1.5 0 0 0 2.25 6v12a1.5 1.5 0 0 0 1.5 1.5Zm10.5-11.25h.008v.008h-.008V8.25Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Z" />
          </svg>
          <h2 class="mt-4 text-xl font-medium tracking-wider text-gray-400">Nenhuma galeria criada</h2>
          <p class="mt-1 text-sm tracking-wider text-gray-500">Clique com o botão direito para criar uma nova galeria.</p>
          <div class="pointer-events-auto mt-4 flex flex-col items-center">
            <p class="mb-3 text-sm text-gray-500">Como tirar uma foto:</p>
            <div class="flex gap-2">
              <button
                data-cursor-pointer
                (click)="openGalleryCreationDialog(); $event.stopPropagation();"
                class="rounded-md bg-gray-700 px-4 py-2 text-sm text-white transition-colors duration-300 hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-gray-500"
              >
                Nova Galeria
              </button>
            </div>
          </div>
        </div>
      } @else {
        <!-- Gallery List Canvas -->
        <div #canvas class="absolute will-change-transform">
          @for (item of visibleItems(); track trackById($index, item)) {
            @if (item.type === 'gallery') {
              <div
                class="item group absolute overflow-hidden rounded-2xl bg-[#1a1a1a] ring-1 transition-[background-color,box-shadow,border-radius] duration-500"
                [class.rounded-[2.5rem]]="themeService.isLight()"
                [class.ring-white\/10]="themeService.isDark()"
                [class.ring-slate-300\/60]="themeService.isLight()"
                [class.pointer-events-none]="!isInteractionEnabled()"
                [class.bg-slate-100]="themeService.isLight()"
                [style.width.px]="item.width"
                [style.height.px]="item.height"
                [style.left.px]="item.x"
                [style.top.px]="item.y"
                [class.cursor-pointer]="isInteractionEnabled()"
                [attr.data-cursor-pointer]="isInteractionEnabled() ? '' : null"
                (click)="selectGallery(item.id)"
                (mouseenter)="onGalleryHoverStart(item.id, item.previewKey)"
                (mouseleave)="onGalleryHoverEnd(item.previewKey)"
                (contextmenu)="onGalleryRightClick($event, item.id)"
              >
                <div class="item-image-container relative h-full w-full overflow-hidden">
                  <img [src]="galleryPreviewImages()[item.previewKey] ?? item.thumbnailUrl"
                       class="h-full w-full object-cover pointer-events-none opacity-0 transition-opacity duration-400"
                       (load)="$event.target.classList.add('opacity-100')"
                       [class.group-hover:scale-105]="isInteractionEnabled()"
                       alt="Capa da Galeria: {{ item.name }}">
                  <div
                    class="pointer-events-none absolute inset-0 z-10 transition-[box-shadow] duration-500"
                    [class.shadow-\[inset_0_0_40px_20px_rgba\(0,0,0,0\.8\)\]]="themeService.isDark()"
                    [class.shadow-\[inset_0_0_28px_18px_rgba\(15,23,42,0\.22\)\]]="themeService.isLight()"
                  ></div>
                </div>
                <span
                  class="pointer-events-none absolute right-2 top-2 z-30 rounded-full bg-black/50 px-1.5 py-0.5 text-[10px] font-semibold text-gray-200 opacity-0 transition-opacity duration-200 group-hover:opacity-100"
                >
                  {{ item.creationOrder }}
                </span>
                <div class="absolute bottom-0 left-0 pl-8 pb-8 text-white opacity-0 transition-opacity duration-300 group-hover:opacity-100">
                  <div class="mb-0.5 text-xs text-gray-300">{{ item.createdAt }}</div>
                  <div class="text-sm font-medium">{{ item.name }}</div>
                </div>
              </div>
            }
          }
        </div>
      }
    } @else {
      <!-- Photo Grid Canvas -->
      @if (images().length === 0) {
        <!-- Empty state for photos in a gallery -->
        <div class="fixed inset-0 z-10 flex flex-col items-center justify-center p-4 text-center">
          <svg class="h-10 w-10 text-gray-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="0.5" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" d="m2.25 15.75 5.159-5.159a2.25 2.25 0 0 1 3.182 0l5.159 5.159m-1.5-1.5 1.409-1.409a2.25 2.25 0 0 1 3.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 0 0 1.5-1.5V6a1.5 1.5 0 0 0-1.5-1.5H3.75A1.5 1.5 0 0 0 2.25 6v12a1.5 1.5 0 0 0 1.5 1.5Zm10.5-11.25h.008v.008h-.008V8.25Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Z" />
          </svg>
          <h2 class="mt-4 text-xl font-medium tracking-wider text-gray-400">Esta galeria está vazia</h2>
          <p class="mt-1 text-sm tracking-wider text-gray-500">Clique com o botão direito para adicionar fotos.</p>
          <div class="mt-4 flex flex-col items-center">
            <p class="mb-3 text-sm text-gray-500">Como tirar uma foto:</p>
            <div class="flex gap-2">
              <button
                data-cursor-pointer
                (click)="openWebcamCapture(); $event.stopPropagation();"
                class="rounded-md bg-gray-700 px-4 py-2 text-sm text-white transition-colors duration-300 hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-gray-500"
              >
                Usar Câmera
              </button>
              <button
                data-cursor-pointer
                (click)="handleSpacebar($event)"
                class="rounded-md bg-gray-700 px-4 py-2 text-sm text-white transition-colors duration-300 hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-gray-500"
              >
                Atalho: Espaço
              </button>
            </div>
          </div>
        </div>
      }
      <div #canvas class="absolute will-change-transform">
        @for (item of visibleItems(); track trackById($index, item)) {
          <div
            class="item group absolute overflow-hidden rounded-2xl bg-[#1a1a1a] ring-1 transition-[background-color,box-shadow,border-radius] duration-500"
            [class.rounded-[2.5rem]]="themeService.isLight()"
            [class.ring-white\/10]="themeService.isDark()"
            [class.ring-slate-300\/60]="themeService.isLight()"
            [class.pointer-events-none]="!isInteractionEnabled()"
            [class.bg-slate-100]="themeService.isLight()"
            [style.width.px]="item.width"
            [style.height.px]="item.height"
            [style.left.px]="item.x"
            [style.top.px]="item.y"
            [class.cursor-pointer]="isInteractionEnabled()"
            [attr.data-cursor-pointer]="isInteractionEnabled() ? '' : null"
            (click)="onImageClick($event, item)"
          >
            <div class="item-image-container relative h-full w-full overflow-hidden">
              @if (item.type === 'photo') {
                <img [src]="item.url"
                     class="h-full w-full object-cover pointer-events-none opacity-0 transition-opacity duration-400"
                     (load)="$event.target.classList.add('opacity-100')"
                     [class.group-hover:scale-1.05]="isInteractionEnabled()"
                     alt="Imagem da galeria capturada pela webcam">
              }
              <div
                class="pointer-events-none absolute inset-0 z-10 transition-[box-shadow] duration-500"
                [class.shadow-\[inset_0_0_40px_20px_rgba\(0,0,0,0\.8\)\]]="themeService.isDark()"
                [class.shadow-\[inset_0_0_28px_18px_rgba\(15,23,42,0\.22\)\]]="themeService.isLight()"
              ></div>
            </div>
            <span
              class="pointer-events-none absolute right-2 top-2 z-30 rounded-full bg-black/50 px-1.5 py-0.5 text-[10px] font-semibold text-gray-200 opacity-0 transition-opacity duration-200 group-hover:opacity-100"
            >
              {{ item.creationOrder }}
            </span>
          </div>
        }
      </div>
    }

    <!-- Relógio e Data -->
    <div class="pointer-events-none absolute bottom-4 left-4 z-20 text-sm font-mono tracking-widest text-gray-700">
      {{ currentTime() }}
    </div>
    <div class="pointer-events-none absolute bottom-4 right-4 z-20 text-sm font-mono tracking-widest text-gray-700">
      {{ currentDate() }}
    </div>

    <!-- Contador de Galerias ou Fotos -->
    <div class="pointer-events-none absolute top-4 right-4 z-20 text-sm font-mono tracking-widest text-gray-700">
      @if (currentView() === 'galleries') {
        {{ galleryCounterLabel() }} {{ galleryCount() }}
      } @else {
        {{ photoCounterLabel() }} {{ photoCount() }}
      }
    </div>

    @if (currentView() === 'photos' && !isIdle()) {
      <!-- Botão Voltar para Galerias -->
      <button (click)="backToGalleries()"
              data-cursor-pointer
              class="absolute left-4 top-4 z-20 rounded-full bg-black/40 p-2 text-white transition hover:bg-black/60 hover:text-gray-300 focus:outline-none">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
        </svg>
      </button>
    }
  }

  @if (isAutoNavigationActive()) {
    <div
      class="fixed inset-0 z-30 cursor-default pointer-events-auto"
      aria-hidden="true"
      data-auto-navigation-shield
    ></div>
  }

  <!-- Overlay para o modo de visualização expandida -->
  <div
    class="overlay pointer-events-none fixed inset-0 z-[9999] bg-black/90 transition-opacity duration-500"
    [class.opacity-100]="!!expandedItem()"
    [class.opacity-0]="!expandedItem()"
    [class.pointer-events-auto]="!!expandedItem()"
    data-cursor-pointer
    (click)="closeExpandedItem()"
  ></div>

  <!-- Elemento para a imagem expandida, renderizado condicionalmente -->
  @if (expandedItem(); as item) {
    <div #expandedItemElement
      class="fixed top-1/2 left-1/2 z-[10000] flex items-center justify-center overflow-hidden rounded-lg bg-black shadow-2xl"
      style="transform: translate(-50%, -50%); will-change: width, height, transform;">
      <img [src]="item.url" class="h-full w-full object-contain pointer-events-none" alt="Imagem expandida">
      @if (isMobileLayout()) {
        <div class="pointer-events-none absolute inset-y-0 left-0 w-16 bg-gradient-to-r from-black/40 to-transparent"></div>
        <div class="pointer-events-none absolute inset-y-0 right-0 w-16 bg-gradient-to-l from-black/40 to-transparent"></div>
      }
    </div>
  }
</div>

@if (autoNavigationOverlayVisible()) {
  <div class="pointer-events-none fixed inset-0 z-40 flex items-center justify-center px-4">
    <div
      class="pointer-events-auto w-full max-w-xl rounded-3xl border px-8 py-6 text-center backdrop-blur-md transition-colors duration-300"
      [ngClass]="themeService.isDark()
        ? 'bg-black/80 text-white/90 border-white/10 shadow-[0_30px_90px_rgba(0,0,0,0.55)]'
        : 'bg-white/85 text-slate-900/90 border-slate-200/80 shadow-[0_30px_90px_rgba(15,23,42,0.18)]'"
    >
      @if (autoNavigationCountdown() !== null) {
        <p class="text-[11px] font-semibold uppercase tracking-[0.32em] opacity-80">
          Navegação automática começa em
        </p>
        <p class="mt-3 text-4xl font-bold tracking-[0.4em]">
          {{ autoNavigationCountdown() }}s
        </p>
      }
      <p class="mt-4 text-sm font-medium leading-relaxed opacity-90">
        Pressione <span class="font-semibold">P</span> ou use o menu de contexto (botão direito) para parar a navegação automática.
      </p>
    </div>
  </div>
}

<!-- Componentes de UI flutuantes -->
@if (contextMenu().visible) {
  <app-context-menu
    [x]="contextMenu().x"
    [y]="contextMenu().y"
    [isFullscreen]="isFullscreen()"
    [groups]="contextMenu().groups"
    [themePalette]="themeService.contextMenuPalette()"
    [themeMode]="themeService.theme()"
    [isAutoNavigationActive]="isAutoNavigationActive()"
    [autoNavigationCountdown]="autoNavigationCountdown()"
    (close)="closeContextMenu()"
    (capture)="openWebcamCapture()"
    (toggleFullscreen)="toggleFullscreen()"
    (toggleTheme)="toggleThemeMode()"
    (togglePlayback)="toggleAutoNavigation()"
    (createGallery)="openGalleryCreationDialog()"
    (editGallery)="editGalleryContextMenu()"
    (deleteGallery)="deleteGalleryContextMenu()"
    (info)="toggleInfoDialog()">
  </app-context-menu>
}

@if (isWebcamVisible()) {
  <div class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-75" (click)="isWebcamVisible.set(false)" data-cursor-pointer>
    <app-webcam-capture
      (capture)="onCaptureComplete($event)"
      (close)="isWebcamVisible.set(false)"></app-webcam-capture>
  </div>
}

@if (isGalleryEditorVisible()) {
  <app-gallery-editor
    [gallery]="editingGallery()"
    (close)="isGalleryEditorVisible.set(false); editingGallery.set(null)"
    (save)="handleGallerySave($event)"
    (delete)="handleGalleryDelete($event)">
  </app-gallery-editor>
}

@if (isGalleryCreationDialogVisible()) {
  <app-gallery-creation-dialog
    (close)="isGalleryCreationDialogVisible.set(false)"
    (save)="handleGalleryCreate($event)">
  </app-gallery-creation-dialog>
}

@if (isInfoDialogVisible()) {
  <app-info-dialog
    (close)="isInfoDialogVisible.set(false)">
  </app-info-dialog>
}