<!-- Container principal da galeria com listeners para interação -->
<div
  class="app-shell"
  [class.is-mobile]="isMobileLayout()"
  [class.is-idle]="isIdle() || isAutoNavigationActive()"
  [class.is-fullscreen]="isFullscreen()"
  (contextmenu)="onRightClick($event)">

  <div class="app-shell__viewport">
  @if (canManageContent()) {
    <div
      class="app-shell__admin-panel"
      [class.app-shell__admin-panel--mobile]="isMobileLayout()">
      <div
        class="identity-card"
        [class.identity-card--mobile]="isMobileLayout()">
        <span class="identity-card__name" [title]="authUserEmail() ?? undefined">{{ authUserEmail() }}</span>
        <span class="identity-card__role">Admin</span>
        <button
          type="button"
          data-cursor-pointer
          class="identity-card__action"
          (click)="signOut()">
          Sair
        </button>
      </div>
    </div>
  }

  @if (isMobileLayout()) {
    @switch (mobileView()) {
      @case ('capture') {
        <div class="flex min-h-screen flex-col bg-black text-white">
          <div class="flex-1 px-6 pt-8 pb-10">
            <app-webcam-capture
              class="h-full"
              [variant]="'mobile'"
              [captureAllowed]="canManageContent() && !!mobileCaptureGallery()"
              (prepareCapture)="prepareMobileCapture()"
              (capture)="onCaptureComplete($event)">
              <ng-container ngProjectAs="[mobileGallerySelection]">
                @if (canManageContent()) {
                  @if (galleries().length === 0) {
                    <button
                      type="button"
                      class="flex w-full items-center gap-4 rounded-3xl border border-dashed border-white/20 bg-white/5 p-4 text-left transition hover:bg-white/10 focus:outline-none focus:ring-2 focus:ring-white/30"
                      (click)="openGalleryCreationDialogForMobileCapture()"
                      data-cursor-pointer>
                      <div
                        class="h-16 w-16 flex-shrink-0 overflow-hidden rounded-2xl border bg-black/40"
                        [ngClass]="themeService.isDark() ? 'border-black/80' : 'border-white/80'">
                        <div class="flex h-full w-full items-center justify-center text-gray-500">
                          <svg
                            xmlns="http://www.w3.org/2000/svg"
                            fill="none"
                            viewBox="0 0 24 24"
                            stroke-width="1.5"
                            stroke="currentColor"
                            class="h-6 w-6">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
                          </svg>
                        </div>
                      </div>
                      <div class="min-w-0 flex-1">
                        <div class="flex items-center gap-2">
                          <h3 class="truncate text-base font-semibold text-white">Crie sua primeira galeria</h3>
                        </div>
                        <p class="mt-1 truncate text-xs text-gray-400">
                          Você ainda não tem galerias. Toque para começar.
                        </p>
                        <div class="mt-2 flex flex-wrap items-center gap-3 text-[11px] uppercase tracking-[0.24em] text-gray-500">
                          <span>Sem data</span>
                          <span>0 fotos</span>
                        </div>
                      </div>
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        viewBox="0 0 24 24"
                        fill="none"
                        class="h-5 w-5 text-gray-400">
                        <path
                          stroke="currentColor"
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          stroke-width="1.5"
                          d="M9 5l7 7-7 7" />
                      </svg>
                    </button>
                  } @else if (mobileCaptureGallery()) {
                    <div class="space-y-3">
                      <app-mobile-gallery-card
                        [gallery]="mobileCaptureGallery()!"
                        [coverUrl]="getGalleryCover(mobileCaptureGallery()!)"
                        [active]="true"
                        [showActiveIndicator]="false"
                        (select)="openMobileGalleryPicker()"
                        (open)="openMobileGalleryDetail(mobileCaptureGallery()!.id)"
                      />
                    </div>
                  } @else {
                    <button
                      type="button"
                      class="flex w-full items-center gap-4 rounded-3xl border border-dashed border-white/20 bg-white/5 p-4 text-left transition hover:bg-white/10 focus:outline-none focus:ring-2 focus:ring-white/30"
                      (click)="openMobileGalleryPicker()"
                      data-cursor-pointer>
                      <div
                        class="h-16 w-16 flex-shrink-0 overflow-hidden rounded-2xl border bg-black/40"
                        [ngClass]="themeService.isDark() ? 'border-black/80' : 'border-white/80'">
                        <div class="flex h-full w-full items-center justify-center text-gray-500">
                          <svg
                            xmlns="http://www.w3.org/2000/svg"
                            fill="none"
                            viewBox="0 0 24 24"
                            stroke-width="1.5"
                            stroke="currentColor"
                            class="h-6 w-6">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
                          </svg>
                        </div>
                      </div>
                      <div class="min-w-0 flex-1">
                        <div class="flex items-center gap-2">
                          <h3 class="truncate text-base font-semibold text-white">Selecionar galeria</h3>
                        </div>
                        <p class="mt-1 truncate text-xs text-gray-400">
                          Escolha uma galeria para salvar suas capturas.
                        </p>
                        <div class="mt-2 flex flex-wrap items-center gap-3 text-[11px] uppercase tracking-[0.24em] text-gray-500">
                          <span>Sem data</span>
                          <span>0 fotos</span>
                        </div>
                      </div>
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        viewBox="0 0 24 24"
                        fill="none"
                        class="h-5 w-5 text-gray-400">
                        <path
                          stroke="currentColor"
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          stroke-width="1.5"
                          d="M9 5l7 7-7 7" />
                      </svg>
                    </button>
                  }
                } @else {
                  <div
                    class="rounded-3xl border border-dashed border-white/20 bg-white/5 p-4 text-center text-xs text-gray-300"
                    (pointerdown)="onMobileGallerySelectorPressStart($event)"
                    (pointerup)="onMobileGallerySelectorPressEnd()"
                    (pointerleave)="onMobileGallerySelectorPressCancel()"
                    (pointercancel)="onMobileGallerySelectorPressCancel()">
                    Entre com a conta administradora para escolher uma galeria e capturar fotos.
                  </div>
                }
              </ng-container>
            </app-webcam-capture>
          </div>
        </div>
      }
      @case ('galleries') {
        <div class="flex min-h-screen h-screen flex-col bg-black text-white">
          <header class="flex items-center justify-between gap-4 px-6 pt-8 pb-4 text-xs uppercase tracking-[0.32em] text-gray-500">
            <div>
              @if (canManageContent()) {
                <button
                  type="button"
                  class="rounded-full border border-white/20 px-4 py-2 text-white transition hover:bg-white/10 focus:outline-none focus:ring-2 focus:ring-white/40"
                  (click)="showMobileCapture()">
                  ← Captura
                </button>
              }
            </div>
            <div>
              @if (canManageContent()) {
                <button
                  type="button"
                  class="rounded-full border border-white/20 px-4 py-2 text-white transition hover:bg-white/10 focus:outline-none focus:ring-2 focus:ring-white/40"
                  (click)="openGalleryCreationDialogForMobileCapture()">
                  Nova
                </button>
              }
            </div>
          </header>
          <div #mobileScrollContainer class="flex-1 overflow-y-auto px-6 pb-16">
            @if (galleries().length === 0) {
              <div class="mt-24 flex flex-col items-center justify-center gap-3 text-center text-gray-300">
                <svg class="h-12 w-12 text-gray-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="0.5" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" d="m2.25 15.75 5.159-5.159a2.25 2.25 0 0 1 3.182 0l5.159 5.159m-1.5-1.5 1.409-1.409a2.25 2.25 0 0 1 3.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 0 0 1.5-1.5V6a1.5 1.5 0 0 0-1.5-1.5H3.75A1.5 1.5 0 0 0 2.25 6v12a1.5 1.5 0 0 0 1.5 1.5Zm10.5-11.25h.008v.008h-.008V8.25Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Z" />
                </svg>
                <h3 class="text-lg font-medium">Nenhuma galeria ainda</h3>
                @if (canManageContent()) {
                  <p class="text-sm text-gray-400">Crie uma galeria para começar a capturar suas memórias.</p>
                } @else {
                  <p class="text-sm text-gray-400">Aguarde a publicação de galerias públicas.</p>
                }
              </div>
            } @else {
              <div class="flex flex-col gap-6">
                @for (gallery of galleries(); track gallery.id) {
                  <app-mobile-gallery-card
                    [gallery]="gallery"
                    [coverUrl]="getGalleryCover(gallery)"
                    [active]="mobileCaptureGalleryId() === gallery.id"
                    (select)="selectMobileCaptureGallery(gallery.id)"
                    (open)="openMobileGalleryDetail(gallery.id)"
                  />
                }
              </div>
            }
          </div>
        </div>
      }
      @case ('galleryDetail') {
        <div class="flex min-h-screen h-screen flex-col bg-black text-white">
          <header class="flex items-center justify-between px-6 pt-8 pb-4 text-xs uppercase tracking-[0.3em] text-gray-500">
            <button
              type="button"
              class="rounded-full border border-white/20 p-2 text-white transition hover:bg-white/10 focus:outline-none focus:ring-2 focus:ring-white/40"
              aria-label="Voltar para galerias"
              (click)="returnToMobileGalleries()">
              <span class="sr-only">Voltar para galerias</span>
              <svg class="h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5 3 12l7.5-7.5M3 12h18" />
              </svg>
            </button>
            <div class="flex items-center gap-3">
              @if (canManageContent()) {
                <button
                  type="button"
                  class="rounded-full border border-white/20 px-4 py-2 text-white transition hover:bg-white/10 focus:outline-none focus:ring-2 focus:ring-white/40 disabled:cursor-not-allowed disabled:opacity-50"
                  [disabled]="!activeGallery()"
                  (click)="activeGallery() && useGalleryForCapture(activeGallery()!.id)">
                  Usar esta galeria
                </button>
                <button
                  type="button"
                  class="rounded-full border border-white/20 p-2 text-white transition hover:bg-red-500/20 focus:outline-none focus:ring-2 focus:ring-red-300 disabled:cursor-not-allowed disabled:opacity-50"
                  aria-label="Excluir galeria"
                  [disabled]="!activeGallery()"
                  (click)="deleteActiveGalleryFromMobile()">
                  <span class="sr-only">Excluir galeria</span>
                  <svg class="h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673A2.25 2.25 0 0 1 15.916 21.75H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0" />
                  </svg>
                </button>
              } @else {
                <span class="text-[10px] uppercase tracking-[0.32em] text-gray-500">Somente visualização</span>
              }
            </div>
          </header>
          <div class="flex-1 overflow-y-auto px-6 pb-20">
            <div class="space-y-2">
              <h2 class="text-2xl font-semibold text-white">{{ activeGallery()?.name ?? 'Galeria' }}</h2>
              @if (activeGallery()?.description) {
                <p class="text-xs text-gray-400">{{ activeGallery()?.description }}</p>
              }
              <div class="flex flex-wrap items-center gap-3 text-xs uppercase tracking-[0.24em] text-gray-500">
                @if (activeGallery()?.createdAt) {
                  <span>{{ activeGallery()?.createdAt }}</span>
                }
                <span>{{ images().length }} fotos</span>
              </div>
            </div>
            @if (images().length === 0) {
              <div class="mt-12 flex flex-col items-center justify-center gap-3 text-center text-gray-300">
                <svg class="h-10 w-10 text-gray-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="0.5" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" d="m2.25 15.75 5.159-5.159a2.25 2.25 0 0 1 3.182 0l5.159 5.159m-1.5-1.5 1.409-1.409a2.25 2.25 0 0 1 3.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 0 0 1.5-1.5V6a1.5 1.5 0 0 0-1.5-1.5H3.75A1.5 1.5 0 0 0 2.25 6v12a1.5 1.5 0 0 0 1.5 1.5Zm10.5-11.25h.008v.008h-.008V8.25Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Z" />
                </svg>
                <h3 class="text-lg font-medium">Esta galeria está vazia</h3>
                @if (canManageContent()) {
                  <p class="text-sm text-gray-400">Capture novas imagens para começar seu diário.</p>
                } @else {
                  <p class="text-sm text-gray-400">Nenhuma foto foi enviada para esta galeria.</p>
                }
              </div>
            } @else {
              <div class="mobile-gallery-grid grid-gallery grid-gallery--tight">
                @for (image of images(); track trackMobileImage($index, image); let index = $index) {
                  <button
                    type="button"
                    class="group relative aspect-square overflow-hidden rounded-3xl bg-zinc-900/60"
                    (click)="onMobilePhotoClick($event, image, index)">
                    <img
                      [src]="image"
                      loading="lazy"
                      class="h-full w-full object-cover transition-transform duration-500 group-active:scale-95 group-hover:scale-[1.03]"
                      alt="Imagem da galeria">
                    <span
                      class="pointer-events-none absolute inset-0 border mix-blend-screen"
                      [ngClass]="themeService.isDark() ? 'border-black/80' : 'border-white/80'"
                    ></span>
                  </button>
                }
              </div>
            }
          </div>
        </div>
      }
    }
  } @else {
    @if (currentView() === 'galleries') {
      @if (galleryService.galleries().length === 0) {
        <!-- Empty state for galleries -->
        <div class="fixed inset-0 z-10 flex flex-col items-center justify-center p-4 text-center pointer-events-none">
          <svg class="h-10 w-10 text-gray-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="0.5" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" d="m2.25 15.75 5.159-5.159a2.25 2.25 0 0 1 3.182 0l5.159 5.159m-1.5-1.5 1.409-1.409a2.25 2.25 0 0 1 3.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 0 0 1.5-1.5V6a1.5 1.5 0 0 0-1.5-1.5H3.75A1.5 1.5 0 0 0 2.25 6v12a1.5 1.5 0 0 0 1.5 1.5Zm10.5-11.25h.008v.008h-.008V8.25Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Z" />
          </svg>
          <h2 class="mt-4 text-xl font-medium tracking-wider text-gray-400">Nenhuma galeria criada</h2>
          @if (canManageContent()) {
            <p class="mt-1 text-sm tracking-wider text-gray-500">Clique com o botão direito para criar uma nova galeria.</p>
            <div class="pointer-events-auto mt-4 flex flex-col items-center">
              <p class="mb-3 text-sm text-gray-500">Como tirar uma foto:</p>
              <div class="flow">
                <button
                  data-cursor-pointer
                  (click)="openGalleryCreationDialog(); $event.stopPropagation();"
                  class="rounded-md bg-gray-700 px-4 py-2 text-sm text-white transition-colors duration-300 hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-gray-500"
                >
                  Nova Galeria
                </button>
              </div>
            </div>
          } @else {
            <p class="mt-1 text-sm tracking-wider text-gray-500">Aguarde o administrador publicar novas galerias.</p>
          }
        </div>
      } @else {
        <!-- Gallery List Canvas -->
        <div #canvas class="absolute will-change-transform">
          @for (item of visibleItems(); track trackById($index, item)) {
            @if (item.type === 'gallery') {
              <div
                class="gallery-card"
                [class.gallery-card--light]="themeService.isLight()"
                [class.is-disabled]="!isInteractionEnabled()"
                [class.is-interactive]="isInteractionEnabled()"
                [style.width.px]="item.width"
                [style.height.px]="item.height"
                [style.left.px]="item.x"
                [style.top.px]="item.y"
                [attr.data-cursor-pointer]="isInteractionEnabled() ? '' : null"
                (click)="selectGallery(item.id)"
                (mouseenter)="onGalleryHoverStart(item.id, item.previewKey)"
                (mouseleave)="onGalleryHoverEnd(item.previewKey)"
                (contextmenu)="onGalleryRightClick($event, item.id)"
              >
                <div class="gallery-card__media">
                  <img [src]="galleryPreviewImages()[item.previewKey] ?? item.thumbnailUrl"
                       class="gallery-card__image"
                       (load)="$event.target.classList.add('is-visible')"
                       alt="Capa da Galeria: {{ item.name }}">
                  <div
                    class="gallery-card__overlay"
                    [class.gallery-card__overlay--dark]="themeService.isDark()"
                    [class.gallery-card__overlay--light]="themeService.isLight()"
                  ></div>
                </div>
                <span class="gallery-card__badge">
                  {{ item.creationOrder }}
                </span>
                <div class="gallery-card__meta stack stack--tight">
                  <div class="text-meta">{{ item.createdAt }}</div>
                  <div class="text-title">{{ item.name }}</div>
                </div>
              </div>
            }
          }
        </div>
      }
    } @else {
      <!-- Photo Grid Canvas -->
      @if (images().length === 0) {
        <!-- Empty state for photos in a gallery -->
        <div class="fixed inset-0 z-10 flex flex-col items-center justify-center p-4 text-center">
          <svg class="h-10 w-10 text-gray-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="0.5" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" d="m2.25 15.75 5.159-5.159a2.25 2.25 0 0 1 3.182 0l5.159 5.159m-1.5-1.5 1.409-1.409a2.25 2.25 0 0 1 3.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 0 0 1.5-1.5V6a1.5 1.5 0 0 0-1.5-1.5H3.75A1.5 1.5 0 0 0 2.25 6v12a1.5 1.5 0 0 0 1.5 1.5Zm10.5-11.25h.008v.008h-.008V8.25Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Z" />
          </svg>
          <h2 class="mt-4 text-xl font-medium tracking-wider text-gray-400">Esta galeria está vazia</h2>
          @if (canManageContent()) {
            <p class="mt-1 text-sm tracking-wider text-gray-500">Clique com o botão direito para adicionar fotos.</p>
            <div class="mt-4 flex flex-col items-center">
              <p class="mb-3 text-sm text-gray-500">Como tirar uma foto:</p>
              <div class="flow">
                <button
                  data-cursor-pointer
                  (click)="openWebcamCapture(); $event.stopPropagation();"
                  class="rounded-md bg-gray-700 px-4 py-2 text-sm text-white transition-colors duration-300 hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-gray-500"
                >
                  Usar Câmera
                </button>
                <button
                  data-cursor-pointer
                  (click)="handleSpacebar($event)"
                  class="rounded-md bg-gray-700 px-4 py-2 text-sm text-white transition-colors duration-300 hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-gray-500"
                >
                  Atalho: Espaço
                </button>
              </div>
            </div>
          } @else {
            <p class="mt-1 text-sm tracking-wider text-gray-500">Nenhuma foto disponível nesta galeria.</p>
          }
        </div>
      }
      <div #canvas class="absolute will-change-transform">
        @for (item of visibleItems(); track trackById($index, item)) {
          <div
            class="photo-card"
            [class.photo-card--light]="themeService.isLight()"
            [class.is-disabled]="!isInteractionEnabled()"
            [class.is-interactive]="isInteractionEnabled()"
            [style.width.px]="item.width"
            [style.height.px]="item.height"
            [style.left.px]="item.x"
            [style.top.px]="item.y"
            [attr.data-cursor-pointer]="isInteractionEnabled() ? '' : null"
            (click)="onImageClick($event, item)"
          >
            <div class="photo-card__media">
              @if (item.type === 'photo') {
                <img [src]="item.url"
                     class="photo-card__image"
                     (load)="$event.target.classList.add('is-visible')"
                     alt="Imagem da galeria capturada pela webcam">
              }
              <div
                class="photo-card__overlay"
                [class.photo-card__overlay--dark]="themeService.isDark()"
                [class.photo-card__overlay--light]="themeService.isLight()"
              ></div>
            </div>
            <span class="photo-card__badge">
              {{ item.creationOrder }}
            </span>
          </div>
        }
      </div>
    }

    <!-- Relógio e Data -->
    <div class="clock">
      {{ currentTime() }}
    </div>
    <div class="date-indicator">
      {{ currentDate() }}
    </div>

    <!-- Contador de Galerias ou Fotos -->
    <div class="counter">
      @if (currentView() === 'galleries') {
        {{ galleryCounterLabel() }} {{ galleryCount() }}
      } @else {
        {{ photoCounterLabel() }} {{ photoCount() }}
      }
    </div>

    @if (currentView() === 'photos' && !isIdle()) {
      <!-- Botão Voltar para Galerias -->
      <button (click)="backToGalleries()"
              data-cursor-pointer
              class="app-shell__back-button button button--icon"
      >
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
        </svg>
      </button>
    }
  }

  @if (isAutoNavigationActive()) {
    <div
      class="auto-navigation-shield"
      aria-hidden="true"
      data-auto-navigation-shield
    ></div>
  }

  <!-- Overlay para o modo de visualização expandida -->
  <div
    class="screen-overlay"
    [class.is-visible]="!!expandedItem()"
    [class.is-hidden]="!expandedItem()"
    data-cursor-pointer
    (click)="closeExpandedItem()"
  ></div>

  <!-- Elemento para a imagem expandida, renderizado condicionalmente -->
  @if (expandedItem(); as item) {
    <div #expandedItemElement
      class="screen-overlay__media"
      style="transform: translate(-50%, -50%); will-change: width, height, transform;">
      <img [src]="item.url" class="h-full w-full object-contain pointer-events-none" alt="Imagem expandida">
      @if (isMobileLayout()) {
        <div class="pointer-events-none absolute inset-y-0 left-0 w-16 bg-gradient-to-r from-black/40 to-transparent"></div>
        <div class="pointer-events-none absolute inset-y-0 right-0 w-16 bg-gradient-to-l from-black/40 to-transparent"></div>
      }
    </div>
  }
</div>

@if (autoNavigationOverlayVisible()) {
  <div class="pointer-events-none fixed inset-0 z-40 flex items-center justify-center px-4">
    <div
      class="pointer-events-auto w-full max-w-xl rounded-3xl border px-8 py-6 text-center backdrop-blur-md transition-colors duration-300"
      [ngClass]="themeService.isDark()
        ? 'bg-black/80 text-white/90 border-white/10 shadow-[0_30px_90px_rgba(0,0,0,0.55)]'
        : 'bg-white/85 text-slate-900/90 border-slate-200/80 shadow-[0_30px_90px_rgba(15,23,42,0.18)]'"
    >
      @if (autoNavigationCountdown() !== null) {
        <p class="text-[11px] font-semibold uppercase tracking-[0.32em] opacity-80">
          Navegação automática começa em
        </p>
        <p class="mt-3 text-4xl font-bold tracking-[0.4em]">
          {{ autoNavigationCountdown() }}s
        </p>
      }
      <p class="mt-4 text-sm font-medium leading-relaxed opacity-90">
        Pressione <span class="font-semibold">P</span> ou use o menu de contexto (botão direito) para parar a navegação automática.
      </p>
    </div>
  </div>
}

<!-- Componentes de UI flutuantes -->
@if (isLoginDialogVisible()) {
  <div class="login-dialog" (click)="closeLoginDialog()" data-cursor-pointer>
    <div
      class="login-dialog__card"
      (click)="$event.stopPropagation()">
      <div class="login-dialog__header">
        <div class="stack stack--tight">
          <h2 class="login-dialog__title">Entrar como administrador</h2>
          <p class="login-dialog__description">Use suas credenciais do Supabase para habilitar as ferramentas de criação.</p>
        </div>
        <button
          type="button"
          data-cursor-pointer
          class="button-reset"
          [class.opacity-50]="isLoginInProgress()"
          [disabled]="isLoginInProgress()"
          (click)="closeLoginDialog()">
          &times;
        </button>
      </div>

      @if (loginError()) {
        <div class="alert alert--danger">
          {{ loginError() }}
        </div>
      }

      <form (submit)="submitLogin(); $event.preventDefault();" class="stack">
        <div class="form-field">
          <label class="form-field__label">Email</label>
          <input
            type="email"
            autocomplete="email"
            class="form-field__input"
            [value]="loginEmail()"
            (input)="loginEmail.set($any($event.target).value)"
            [disabled]="isLoginInProgress()"
            required>
        </div>

        <div class="form-field">
          <label class="form-field__label">Senha</label>
          <input
            type="password"
            autocomplete="current-password"
            class="form-field__input"
            [value]="loginPassword()"
            (input)="loginPassword.set($any($event.target).value)"
            [disabled]="isLoginInProgress()"
            required>
        </div>

        <div class="stack stack--tight">
          <button
            type="submit"
            data-cursor-pointer
            class="button button--primary button--block"
            [disabled]="isLoginInProgress()">
            @if (isLoginInProgress()) { Entrando... } @else { Entrar }
          </button>
          <p class="form-hint">Apenas contas autorizadas podem gerenciar galerias.</p>
        </div>
      </form>
    </div>
  </div>
}

@if (contextMenu().visible) {
  <app-context-menu
    [x]="contextMenu().x"
    [y]="contextMenu().y"
    [isFullscreen]="isFullscreen()"
    [groups]="contextMenu().groups"
    [themeMode]="themeService.theme()"
    [isAutoNavigationActive]="isAutoNavigationActive()"
    [autoNavigationCountdown]="autoNavigationCountdown()"
    (close)="closeContextMenu()"
    (capture)="openWebcamCapture()"
    (toggleFullscreen)="toggleFullscreen()"
    (toggleTheme)="toggleThemeMode()"
    (togglePlayback)="toggleAutoNavigation()"
    (createGallery)="openGalleryCreationDialog()"
    (editGallery)="editGalleryContextMenu()"
    (deleteGallery)="deleteGalleryContextMenu()"
    (info)="toggleInfoDialog()">
  </app-context-menu>
}

@if (isWebcamVisible() && canManageContent()) {
  <div class="overlay-panel" (click)="isWebcamVisible.set(false)" data-cursor-pointer>
    <app-webcam-capture
      [captureAllowed]="canManageContent()"
      (capture)="onCaptureComplete($event)"
      (close)="isWebcamVisible.set(false)"></app-webcam-capture>
  </div>
}

@if (isGalleryEditorVisible() && canManageContent()) {
  <app-gallery-editor
    [gallery]="editingGallery()"
    (close)="isGalleryEditorVisible.set(false); editingGallery.set(null)"
    (save)="handleGallerySave($event)"
    (delete)="handleGalleryDelete($event)">
  </app-gallery-editor>
}

@if (isGalleryCreationDialogVisible() && canManageContent()) {
  <app-gallery-creation-dialog
    (close)="isGalleryCreationDialogVisible.set(false)"
    (save)="handleGalleryCreate($event)">
  </app-gallery-creation-dialog>
}

@if (isInfoDialogVisible()) {
  <app-info-dialog
    (close)="isInfoDialogVisible.set(false)">
  </app-info-dialog>
}
</div>
